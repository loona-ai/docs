
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <style media="print">
      * {
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/api.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="api" data-languages="[&quot;shell&quot;]">
    <a href="#" id="nav-button">
          <span>
            <img src="images/navbar-2.png" alt="Navbar 2" />
          </span>
    </a>

    <div class="toc-wrapper">
      <a href="/" title="Back to API documentation">
        <img src="images/logo.png" width="200px" alt="Logo" />
      </a>
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#api" class="toc-h1 toc-link" data-title="Основы работы с API">Основы работы с API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#39c6387206" class="toc-h2 toc-link" data-title="Обзор">Обзор</a>
                  </li>
                  <li>
                    <a href="#a1ce3c1a83" class="toc-h2 toc-link" data-title="Аутентификация">Аутентификация</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#db706448c8" class="toc-h1 toc-link" data-title="Транзакции">Транзакции</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#3c7692c5ba" class="toc-h2 toc-link" data-title="Идемпотентность">Идемпотентность</a>
                  </li>
                  <li>
                    <a href="#qr" class="toc-h2 toc-link" data-title="Значение QR кода на карте">Значение QR кода на карте</a>
                  </li>
                  <li>
                    <a href="#e8924843c1" class="toc-h2 toc-link" data-title="Типы транзакций">Типы транзакций</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#681b5ae3d2" class="toc-h1 toc-link" data-title="Ошибки">Ошибки</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://app.loona.ai/signup'>Получить API ключ</a></li>
        </ul>
    </div>
    <div class="page-wrapper code-page api-content">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='api'>Основы работы с API</h1><h2 id='39c6387206'>Обзор</h2>
<p>Документация предназначена для разработчиков, которые хотят интегрироваться с платформой Loona.ai. В целом возможны два варианта интеграции:</p>

<ol>
<li>Использование системы лояльности Loona, что подразумевает проведение транзакций по использованию и погашению электронных карт (<strong>купон</strong>, <strong>чоп карты</strong>), по списанию с баланса во время покупки (<strong>бонусные карты</strong> и <strong>подарочные сертификаты</strong>) или же по применению скидки а накоплению на баланс (<strong>скидочные</strong> и <strong>бонусные</strong> карты, соответственно) с одновременным увеличением суммы покупок и переходом при достижении нужного порога на более высокий уревень лояльности. </li>
<li>Реализация собственной системы лояльности через карты Loona. Данный API предоставляет возможность самим создавать карты и изменять значения данных, а также статус и срок истечения (т.е. производить транзакции на своей стороне и обновлять карты на нашей). При создании карты будет доступна ссылка для скачивания, а при каждой модификации система Loona автоматически обеспечит почти мгновенное обновление на устройстве владельца карты.</li>
</ol>

<p>Для реализации первого варианта разработчикам потребуется <code>Transactions API</code>, а также endpoint <code>GET /passes/encrypted/{encryptedId}</code> для получения информации о карте клиента. </p>

<p>Для реализации второго варианта необходимо воспользоваться <code>Templates API</code> и <code>Passes API</code> (кроме вышеуказанного).</p>

<p>Базовым адресом API является <code>https://api.loona.ai/version1</code></p>
<h2 id='a1ce3c1a83'>Аутентификация</h2>
<blockquote>
<p>Для прохождения авторизации воспользуйтесь следующим примером</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl https://api.loona.ai/oauth/token <span class="se">\</span>
  -X POST <span class="se">\</span>
  -H <span class="s1">'Authorization: Basic Y2xpZW50Og=='</span> <span class="se">\</span>
  -d <span class="s1">'grant_type=client_credentials'</span>
</code></pre><pre class="highlight shell tab-shell"><code><span class="c"># Пример ответа</span>
<span class="o">{</span>
  <span class="s2">"access_token"</span>: <span class="s2">"eyJhb***********YW1lIjoiZ2xvYmF"</span>,
  <span class="s2">"token_type"</span>: <span class="s2">"bearer"</span>,
  <span class="s2">"expires_in"</span>: 299,
  <span class="s2">"scope"</span>: <span class="s2">"any"</span>,
  <span class="s2">"jti"</span>: <span class="s2">"0e6da94a-8a35-4b6e-85da-8f54eb1be88b"</span>
<span class="o">}</span>
</code></pre>
<p>Все запросы API требуют аутентификации. Нужно установить HTTP-заголовок авторизации, который включает в себя тип Bearer и access token.</p>
<h4 id='7c48485c72'>Пример заголовка</h4>
<p><code>Authorization: Bearer eyJhb***********YW1lIjoiZ2xvYmF</code></p>

<p>Для получения токена необходимо отправить POST запрос на <code>/oauth/token</code> с указанием client id(идентификатор) и secret(секретный ключ) в заголовке, которые можно получить в вашем личном кабинете app.loona.ai, в разделе API -&gt; Клиенты. Для работы с API вам потребуется создать клиент типа APP. Скопируйте и сохраните секретный ключ в безопасном месте, так как после закрытия данного окна ключ будет недоступен. Ключ можно будет заменить на новый в любое время, тогда как старый станет недействительным. Что касается client id, то он будет доступен для копирования всегда.</p>

<p>Создание заголовка для получения access token:
- Идентификатор клиента и секретный ключ объединяются с использованием двоеточия (:) в качестве разделителя <code>&lt;clientId&gt;:&lt;secret&gt;</code>
- Полученная строка кодируется с использованием кодировки Base64.
- Закодированная строка добавляется после типа &quot;Basic&quot;.</p>

<p>А также нужно указать параметр <strong>grant_type: *client_credentials</strong>*</p>

<aside class="notice">
Не забудьте заменить eyJhb***********YW1lIjoiZ2xvYmF на свой личный API ключ.
</aside>
<h1 id='db706448c8'>Транзакции</h1><h2 id='3c7692c5ba'>Идемпотентность</h2>
<p>В контексте API идемпотентность означает, что многократные запросы обрабатываются так же, как однократные.
Это значит, что получив повторный запрос с теми же параметрами(в частности, passId), Loona выдаст в ответе результат исходного запроса.
Такое поведение помогает избежать нежелательного повторения транзакций. Например, если при проведении транзакции возникли проблемы с сетью, и соединение прервалось, вы сможете безопасно повторить нужный запрос неограниченное количество раз.
GET-запросы являются по умолчанию идемпотентными, так как не имеют нежелательных последствий.
Для обеспечения идемпотентности POST-запросов используется заголовок Idempotence-Key (или ключ идемпотентности).</p>
<h4 id='7c48485c72-2'>Пример заголовка</h4>
<p><code>Idempotence-Key: anyUniqueIdentifier</code></p>
<h2 id='qr'>Значение QR кода на карте</h2>
<p>В зависимости от настроек в личном кабинете QR код может иметь следующие значения:
- статичный уникальный идентификатор карты
- статичный уникальный идентификатор карты в зашифрованном виде
- динамичный уникальный идентификатор карты в зашифрованном виде (меняется после каждой транзакции)</p>

<p>Значение QR кода, который по умолчанию представляет собой статичный зашифрованный идентификатор карты, нужно отправить в HTTP-заголовке X-Loona-Encrypted-Key при запросах на проведение транзакции. Если encryptedId недействительный, тогда система выдаст ошибку 400. Возможной причиной такой ошибки может быть отсутствие интернета на устройстве владельца карты, вследствие чего карта не была обновлена после последней транзакции (ее в любое время можно обновлять вручную при подключении к интернету). Если хотите избежать подобного сценария, то всегда можете <code>Отключить динамический QR-code</code> в настройках макета в вашем личном 
 кабинете.</p>
<h4 id='7c48485c72-3'>Пример заголовка</h4>
<p><code>X-Loona-Encrypted-Key: 6179518025</code></p>
<h2 id='e8924843c1'>Типы транзакций</h2>
<blockquote>
<p>Пример запроса</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl https://api.loona.ai/version1/transactions/&lt;transaction <span class="nb">type</span>&gt; <span class="se">\</span>
  -X POST <span class="se">\</span>
  -H <span class="s1">'Authorization: Bearer &lt;Токен доступа&gt;'</span> <span class="se">\</span>
  -H <span class="s1">'Idempotence-Key: &lt;Ключ идемпотентности&gt;'</span> <span class="se">\</span>
  -H <span class="s1">'X-Loona-Encrypted-Key: &lt;Зашифрованный идентификатор карты, полученный через чтение значения QR кода&gt;'</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
        "passId": &lt;идентификатор карты в системе Loona, полученный в ответе запроса GET под полем id&gt;,
        "purchaseId": "&lt;идентификатор заказа/покупки/действия на вашей стороне&gt;"
        // другие поля
      }'</span>
</code></pre>
<p>На данный момент в рамках системы лояльности Loona поддерживаются следующие типы транзакций: </p>

<ul>
<li><strong>purchase</strong>: для скидочных и бонусных карт</li>
<li><strong>spending</strong>:  для бонусных и подарочных карт</li>
<li><strong>purchase-spending</strong>: для бонусных карт</li>
<li><strong>status</strong>: для купонов</li>
<li><strong>chop</strong>: для чоп карт</li>
</ul>

<p>Информацию о запросах и ответах каждого из вышеперечисленных запросов можете найти в детализированной <a href="https://api.loona.ai/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config#/"><strong>документации</strong></a> Loona API</p>
<h1 id='681b5ae3d2'>Ошибки</h1>
<aside class="notice">
This error section is stored in a separate file in <code>includes/_errors.md</code>. Slate allows you to optionally separate out your docs into many files...just save them to the <code>includes</code> folder and add them to the top of your <code>index.md</code>'s frontmatter. Files are included in the order listed.
</aside>

<p>The Kittn API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request -- Your request is invalid.</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized -- Your API key is wrong.</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden -- The kitten requested is hidden for administrators only.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found -- The specified kitten could not be found.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed -- You tried to access a kitten with an invalid method.</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable -- You requested a format that isn&#39;t json.</td>
</tr>
<tr>
<td>410</td>
<td>Gone -- The kitten requested has been removed from our servers.</td>
</tr>
<tr>
<td>418</td>
<td>I&#39;m a teapot.</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests -- You&#39;re requesting too many kittens! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error -- We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable -- We&#39;re temporarily offline for maintenance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
          </div>
      </div>
    </div>
  </body>
</html>
