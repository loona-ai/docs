
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Integration Documentation</title>
    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
      .tab-json--inline table td { padding: 5px; }
.tab-json--inline table pre { margin: 0; }
.tab-json--inline, .tab-json--inline .w {
  color: #586e75;
}
.tab-json--inline .err {
  color: #002b36;
  background-color: #dc322f;
}
.tab-json--inline .c, .tab-json--inline .cd, .tab-json--inline .cm, .tab-json--inline .c1, .tab-json--inline .cs {
  color: #657b83;
}
.tab-json--inline .cp {
  color: #b58900;
}
.tab-json--inline .nt {
  color: #b58900;
}
.tab-json--inline .o, .tab-json--inline .ow {
  color: #93a1a1;
}
.tab-json--inline .p, .tab-json--inline .pi {
  color: #93a1a1;
}
.tab-json--inline .gi {
  color: #859900;
}
.tab-json--inline .gd {
  color: #dc322f;
}
.tab-json--inline .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.tab-json--inline .k, .tab-json--inline .kn, .tab-json--inline .kp, .tab-json--inline .kr, .tab-json--inline .kv {
  color: #6c71c4;
}
.tab-json--inline .kc {
  color: #cb4b16;
}
.tab-json--inline .kt {
  color: #cb4b16;
}
.tab-json--inline .kd {
  color: #cb4b16;
}
.tab-json--inline .s, .tab-json--inline .sb, .tab-json--inline .sc, .tab-json--inline .sd, .tab-json--inline .s2, .tab-json--inline .sh, .tab-json--inline .sx, .tab-json--inline .s1 {
  color: #859900;
}
.tab-json--inline .sr {
  color: #2aa198;
}
.tab-json--inline .si {
  color: #d33682;
}
.tab-json--inline .se {
  color: #d33682;
}
.tab-json--inline .nn {
  color: #b58900;
}
.tab-json--inline .nc {
  color: #b58900;
}
.tab-json--inline .no {
  color: #b58900;
}
.tab-json--inline .na {
  color: #268bd2;
}
.tab-json--inline .m, .tab-json--inline .mf, .tab-json--inline .mh, .tab-json--inline .mi, .tab-json--inline .il, .tab-json--inline .mo, .tab-json--inline .mb, .tab-json--inline .mx {
  color: #859900;
}
.tab-json--inline .ss {
  color: #859900;
}
    </style>
    <link href="../stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" media="print" />
    <link href="../images/favicon.ico" rel="icon" type="image/ico" />
      <script src="../javascripts/all.js"></script>
  </head>

  <body class="guides guides_integration" data-languages="[]">
    <a href="#" id="nav-button">
              <span>
                <img src="../images/navbar-2.png" alt="Navbar 2" />
              </span>
    </a>

    <div class="toc-wrapper">
      <a href="/" title="Back to API documentation">
        <img src="../images/logo.png" width="200px" alt="Logo" />
      </a>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <a class="faux-toc-link" href="/">Вернуться в Loona Docs </a>
          <li>
            <a href="#iiko" class="toc-h1 toc-link" data-title="iiko">iiko</a>
              <ul class="toc-list-h2">
                    <li>
                      <a href="#b022bdab41" class="toc-h2 toc-link" data-title="Установка плагина">Установка плагина</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#1bb1787d93" class="toc-h2 toc-link" data-title="Создание Скидки">Создание Скидки</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#a1b4ba21e5" class="toc-h2 toc-link" data-title="Создание Купона">Создание Купона</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#fa903e6def" class="toc-h2 toc-link" data-title="Создание Бонуса или Подарочного сертификата">Создание Бонуса или Подарочного сертификата</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#1e15b4ecad" class="toc-h2 toc-link" data-title="Настройки плагина">Настройки плагина</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#iiko-waiter" class="toc-h2 toc-link" data-title="Активация сканирования в iiko waiter">Активация сканирования в iiko waiter</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#2d" class="toc-h2 toc-link" data-title="Активация 2D канера">Активация 2D канера</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#4f6db5306b" class="toc-h2 toc-link" data-title="Настройки в кабинете">Настройки в кабинете</a>
                                <ul class="toc-list-h3">
                                    <li>
                                      <a href="#443ab601a2" class="toc-h3 toc-link" data-title="Редактирование макета:">Редактирование макета:</a>
                                    </li>
                                </ul>
                    </li>
                    <li>
                      <a href="#api-token" class="toc-h2 toc-link" data-title="Создание API token сканера для карты">Создание API token сканера для карты</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
              </ul>
          </li>
          <li>
            <a href="#r_keeper" class="toc-h1 toc-link" data-title="r_keeper">r_keeper</a>
              <ul class="toc-list-h2">
                    <li>
                      <a href="#b022bdab41-2" class="toc-h2 toc-link" data-title="Установка плагина">Установка плагина</a>
                                <ul class="toc-list-h3">
                                    <li>
                                      <a href="#farcards" class="toc-h3 toc-link" data-title="Настройки FARCARDS">Настройки FARCARDS</a>
                                    </li>
                                    <li>
                                      <a href="#3853178052" class="toc-h3 toc-link" data-title="Установка плагина - продолжение:">Установка плагина - продолжение:</a>
                                    </li>
                                </ul>
                    </li>
                    <li>
                      <a href="#mcr" class="toc-h2 toc-link" data-title="Создание MCR алгоритма">Создание MCR алгоритма</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#pds" class="toc-h2 toc-link" data-title="Настройка PDS">Настройка PDS</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#fa903e6def-2" class="toc-h2 toc-link" data-title="Создание Бонуса или Подарочного сертификата">Создание Бонуса или Подарочного сертификата</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#1bb1787d93-2" class="toc-h2 toc-link" data-title="Создание Скидки">Создание Скидки</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#a1b4ba21e5-2" class="toc-h2 toc-link" data-title="Создание Купона">Создание Купона</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#35621b3930" class="toc-h2 toc-link" data-title="Необходимые Настройки в офисе и плагине">Необходимые Настройки в офисе и плагине</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
                    <li>
                      <a href="#4f6db5306b-2" class="toc-h2 toc-link" data-title="Настройки в кабинете">Настройки в кабинете</a>
                                <ul class="toc-list-h3">
                                    <li>
                                      <a href="#443ab601a2-2" class="toc-h3 toc-link" data-title="Редактирование макета:">Редактирование макета:</a>
                                    </li>
                                </ul>
                    </li>
                    <li>
                      <a href="#api-token-2" class="toc-h2 toc-link" data-title="Создание API Token сканера для карты">Создание API Token сканера для карты</a>
                                <ul class="toc-list-h3">
                                </ul>
                    </li>
              </ul>
          </li>
      </div>

    </div>
    <div class="page-wrapper code-page">
      <div class="content">
        <h1 id='iiko'>iiko</h1><h2 id='b022bdab41'>Установка плагина</h2>
<ul>
<li><p>Копируем папку LoonaPluginSettings в C:\ProgramData </p></li>
<li><p>Копируем папки LoonaPlugin (и iikoWaiter5 при необходимости) в директорию iikoFront/Plugins (в нашем случае C:\Program Files\iiko\iikoRMS\Front.Net\Plugins)</p></li>
<li><p>Запускаем iiko Front (помним что для данного метода необходима лицензия типа iikoFrontPaymentPlugin)</p></li>
</ul>
<h2 id='1bb1787d93'>Создание Скидки</h2>
<ul>
<li>Открываем iiko Office

<ul>
<li>Переходим в раздел Дисконтная Система -&gt; Скидки и Надбавки</li>
<li>Добавляем скидку</li>
<li>Пишем свои названия скидок как показано ниже, они будут использованы в настройках плагина</li>
<li>Тип скидки ставим Скидки и Надбавки</li>
<li>Нажимаем Далее</li>
</ul></li>
</ul>

<p><img src="../images/iiko%20add%20skidka.png" width="900"></p>

<ul>
<li>Убираем галочку &quot;Можно назначить вручную&quot;, остальное по усмотрению ресторана</li>
</ul>

<p><img src="../images/iiko%20add%20skidka%202.png" width="600"></p>

<ul>
<li>Тип ставим “Процент” и назначаем процент данной скидки</li>
</ul>

<p><img src="../images/iiko%20add%20skidka%203.png" width="900"></p>

<ul>
<li><p>Нажимаем Далее и заканчиваем установку скидки.</p></li>
<li><p><strong>Повторяем добавление скидки со всеми имеющимся уровнями скидок</strong></p></li>
</ul>
<h2 id='a1b4ba21e5'>Создание Купона</h2>
<p>Для создания купона пройдите все пункты для создания скидки, но измените указаный процент скидки на 100%.</p>
<h2 id='fa903e6def'>Создание Бонуса или Подарочного сертификата</h2>
<ul>
<li><p>Добавляем внешний вид оплаты. Переходим в раздел “Розничные продажи”  нажимаем на “Тип платы” и добавляем новую оплату. </p></li>
<li><p>Обязательно указываем данные так же: </p>

<ul>
<li>Наименование - LoonaPayment </li>
<li>Тип - Внешний тип оплаты<br></li>
<li>Название в чеке - Электронная карта </li>
<li>Безналичный тип - LoonaPayment</li>
</ul></li>
<li><p>Сохраняем</p></li>
</ul>

<p><img src="../images/iiko6.png" width="665"></p>
<h2 id='1e15b4ecad'>Настройки плагина</h2>
<ul>
<li><p>Открываем Браузер</p></li>
<li><p>Заходим на http://localhost:1234/settings</p></li>
<li><p>Задаем настройки:</p>

<ul>
<li>Api access token - доступен после создания сканера в кабинете (подробнее в разделе настройки кабинета) или по запросу от поддержки компании Loona</li>
<li>Api base url - https://api.loona.ai<br></li>
<li>Plugin url - http://localhost<br></li>
<li>Waiter port - 1234</li>
</ul></li>
<li><p>Далее заполняем детали всех имеющихся уровней скидок в кабинете, и <strong>называем их так же как названы соответствующие уровни скидок в iiko office</strong></p></li>
</ul>

<p><img src="../images/iiko%20plugin%20settings.png" width="900"></p>

<ul>
<li>Устанавливаем мобильное приложение iikoWaiter5 если нужно</li>
</ul>
<h2 id='iiko-waiter'>Активация сканирования в iiko waiter</h2>
<ul>
<li><p>Зайдите в localhost:8100/settings через браузер</p></li>
<li><p>Пройдите к &quot;Loyalty System Integration Settings&quot;</p></li>
<li><p>Задайте настройки:</p>

<ul>
<li>Loyalty plugin address: localhost:1234/api/op</li>
<li>Отметьте &quot;галочкой&quot; Is External Loyalty Enabled</li>
</ul></li>
</ul>

<p><img src="../images/iiko_waiter_settings.png" width="800"></p>

<ul>
<li>Сохраните настройки</li>
</ul>

<p><em>Если не можете зайти в настройки по ссылке выше</em>:</p>

<ul>
<li><p>Зайдите в кассу</p></li>
<li><p>Нажмите на &quot;Дополнения&quot; и затем на &quot;iikoWaiter Настройки&quot;</p></li>
</ul>

<p><img src="../images/iiko_settings.png" width="800"></p>

<ul>
<li>Откроется QR код, отсканируйте его и пройдите по ссылке</li>
</ul>

<p><img src="../images/iiko_setting_address.png" width="800"></p>
<h2 id='2d'>Активация 2D канера</h2>
<ul>
<li><p>Заходим в раздел Сотрудники -&gt; Сотрудники и добавляем сотрудника</p></li>
<li><p>Обязательно введите имя сотрудника &quot;Loona&quot;</p></li>
<li><p>Ставим галочку &quot;Только для плагинов&quot;</p></li>
<li><p>Ставим галочку на &quot;Сотрудник&quot;</p></li>
<li><p>Добавляем должность - &quot;Системный Администратор&quot;</p></li>
</ul>

<p><img src="../images/add_worker.png" width="800"></p>

<ul>
<li><p>Далее, пройдите в секцию &quot;Дополнительные сведения&quot;</p></li>
<li><p>Обязательно введите ПИН-код: <strong>1945</strong></p></li>
<li><p>Сохраните изменения</p></li>
</ul>

<p><img src="../images/add_worker_2.png" width="600"></p>

<ul>
<li>Перезагрузите кабинет</li>
</ul>
<h2 id='4f6db5306b'>Настройки в кабинете</h2><h3 id='443ab601a2'>Редактирование макета:</h3>
<p><strong>Для использования скидок, подарочных сертификатов и бонусов</strong> в системе iiko штрихкод на карте должен содержать Номер Карты. Для настройки штрихкода на Номер Карты:</p>

<ul>
<li><p>Зайдите в ваш личный кабинет Loona</p></li>
<li><p>Перейдите в раздел <strong>Макеты</strong></p></li>
<li><p>Зайдите в <img src="../images/иконка%20редактирования.png" width="12" height="12" alt="редактирование"> <strong>редактирование</strong> того макета на который хотите настроить сканер</p></li>
</ul>

<p><img src="../images/Number%20scanner.png" width="624"></p>

<ul>
<li><p>Перейдите в секцию <strong>Дизайн</strong></p></li>
<li><p>Нажмите на штрихкод, в настройках поля откроются настройки штрихкода</p></li>
<li><p>Поменяйте значение на <strong>Номер Карты</strong></p></li>
</ul>

<p><strong>Для использования купона:</strong></p>

<ul>
<li><p>В значении штрихкода поменять значение на “своё значение”</p></li>
<li><p>Поменять своё значение на ${pid}/№Продукт, где “№Продукт” это номер под которым позиция (блюдо) зарегистрирована в iikoOffice.</p></li>
<li><p>Использовать карты Loona</p></li>
</ul>
<h2 id='api-token'>Создание API token сканера для карты</h2>
<p>Для интеграции с системой iiko вам необходимо создать сканер в кабинете Loona и использовать его токен доступа. </p>

<p>Для создания нового сканера:</p>

<ul>
<li>Зайдите в ваш личный кабинет Loona</li>
</ul>

<p><img src="../images/maket_create.png" width="600"></p>

<ul>
<li><p>В разделе Сканер нажмите на Создать сканер.</p></li>
<li><p>Введите название нового сканера</p></li>
<li><p>Выберите тип сканера - &quot;App&quot;.</p></li>
<li><p>Выберите макеты с картами которые предназначены для сканирования, или отметьте Получить полный доступ чтобы сканер работал со всеми вашими макетами.</p></li>
<li><p>Нажмите Создать</p></li>
</ul>

<p>В списке созданных сканеров появится новый сканер со своим <strong>токеном доступа</strong> (Идентификационный номер), этот номер используется при настройке плагина.</p>
<h1 id='r_keeper'>r_keeper</h1><h2 id='b022bdab41-2'>Установка плагина</h2>
<p>Перед установкой нобходимо:</p>

<ul>
<li><p>Убедиться в наличии .Net Framework версии 4.6.2. или выше. Версия бывает доступна на ОС Windows 7 и новее.</p></li>
<li><p>В течении использования плагина, нужно выключить Windows Firewall или открыть доступ для порта плагина (port 1234)</p></li>
<li><p>Необходимо настроить имеющийся FARCARDS.ini (настройки ниже)</p></li>
<li><p>Скачайте и откройте папку плагина Loona</p></li>
</ul>

<p><img src="../images/rk1.png" width="600" ></p>

<ul>
<li><p>В папке для вашего удобства содержится FARCARDS со всеми необходимыми настройками в нём. Если имеется FARCARDS, можно настроить его вручную.</p></li>
<li></li>
</ul>
<h3 id='farcards'>Настройки FARCARDS</h3>
<ul>
<li>  Скопируйте «Extdll.dll» и «Extdll.ini» в папку UCS/FARCARDS</li>
</ul>

<p><img src="../images/rk2.png" width="550" ></p>

<ul>
<li><p>Откройте файл «FARCARDS.INI» в текстовом редакторе</p></li>
<li><p>В поле DLL впишите «ExtDll.dll» и сохраните изменения</p></li>
</ul>

<p><img src="../images/rk3.png" width="700"></p>

<ul>
<li>  Запустите  «Farcards.exe – install»</li>
</ul>
<h3 id='3853178052'>Установка плагина - продолжение:</h3>
<ul>
<li><p>Откройте папку Loona R-keeper</p></li>
<li><p>Скопируйте папку Loona в папку где хратится r_keeper и FARCARDS</p></li>
</ul>

<p><img src="../images/rk15.png" width="750"></p>

<ul>
<li>  Откройте скопированую папку Loona, и запустите из нее файл «ServiceInstaller.exe» как администратор</li>
</ul>

<p><img src="../images/rk16.png" width="700"></p>

<ul>
<li>  Сервис будет установлен, после установки зайдите в Windows -&gt; Services (Сервисы), найдите Loona r-keeper plugin и убедитесь что «Startup Type» стоит автоматичекий (Automatic)</li>
</ul>

<p><img src="../images/rk17.png" width="900"></p>

<ul>
<li>  Не закрывайте окно сервисов</li>
</ul>
<h2 id='mcr'>Создание MCR алгоритма</h2>
<ul>
<li>  Откройте папку где содержится R-keeper и запустите R-keeper «Manager»</li>
</ul>

<p><img src="../images/rk4.png" width="700"></p>

<ul>
<li>  Далее, откройте r_keeper менеджер и пройдите в <strong><em>Сервисы -&gt; Обработка Сигналов Устройств -&gt; MCR алгоритмы</em></strong></li>
</ul>

<p><img src="../images/rk_extra1.PNG" width="900"> </p>

<ul>
<li>  Откроется страничка существующих алгоритмов. Убедитесь что у вас имеется алгоритм loona.</li>
</ul>

<p><img src="../images/rk_extra2.PNG" width="900"> </p>

<ul>
<li><p>Создайте новый алгоритм для элекртонных карт</p></li>
<li><p>Для создания нового алгоритма можно просто скопировать любой имеющийся алгоритм и вставить его в окно алгоритмов. </p></li>
</ul>

<p><img src="../images/rk_extra_if1.PNG" width="600"> </p>

<p><img src="../images/rk_extra_if2.PNG" width="600"> </p>

<ul>
<li><p>После этого переименуйте скопированый алгоритм на <strong>loona</strong>.</p></li>
<li><p>Нажмите на алгоритм и откроются свойства справа, поменяйте статус на <strong>Active</strong> и затем убедитесь что все настройки совпадают с настройками представленными ниже:</p></li>
</ul>

<p><img src="../images/rk_extra_if3.png" width="900"> </p>

<ul>
<li>  Нажмите на скрипт, и откройте окно скрипта с помощью иконки слева.</li>
</ul>

<p><img src="../images/rk_extra3.png" width="900"> </p>

<ul>
<li>  В окне скрипта замените имеющийся скрипт на код расположенный ниже:</li>
</ul>

<pre><code>
function MCR1000028(DeviceSignal: Integer; DeviceIdent: Integer; var Parameter: String): Boolean;
var enc: integer; id, ratio, couponeCode :integer; 
var encShift, couponCodeShift :integer;
var couponSeparateSymbol :String;        
var idString:String;
var cardCodeResult:Int64;
begin 
 
  Result:=false;           
  ratio :=1000; 
  encShift :=48;
  couponCodeShift:=36;
  couponSeparateSymbol := '/';    
  if pos('-', Parameter) > 1 then begin
        Enc := StrToIntDef(copy(Parameter, 1, pos('-', Parameter) - 1),-1);
        if Enc>0 then begin
          idString := copy(Parameter, pos('-', Parameter)+1, length(Parameter));
          
          if pos(couponSeparateSymbol, idString) > 1 then begin
            couponeCode := StrToIntDef(copy(idString, pos(couponSeparateSymbol, idString)+1, length(idString)),-1);
            idString :=   copy(idString, 1, pos(couponSeparateSymbol, idString) - 1)       
          end; 
          id :=  StrToIntDef(idString,-1);
          cardCodeResult :=     (enc shl encShift ) and (StrToInt64('0x7FFF')shl encShift);
          cardCodeResult :=    cardCodeResult or ((couponeCode shl couponCodeShift) and (StrToInt64('0xFFF')shl couponCodeShift) ) ;
          cardCodeResult :=    cardCodeResult or id;
          Parameter :=Int64ToStr(cardCodeResult);
          Result:=true;     
        end;  
  end;       
end;
<img src="../images/rk_extra4.PNG" width="900"> 
</code></pre>

<ul>
<li>  Нажмите &quot;Ок&quot; и закройте окно</li>
</ul>
<h2 id='pds'>Настройка PDS</h2>
<p>В настройку PDS входит:</p>

<ul>
<li><p>Создание PDS интерфейса</p></li>
<li><p>Создание и настройка кассового сервера (устройство)</p></li>
<li><p>Создание валюты для оплаты с PDS (не обязательно для скидкочной лояльности)</p></li>
<li><p>Введение интерфейсов PDS FARCARDS.ini и TMS.ini (при необходимости и наличии мобильного официанта)</p></li>
<li><p>Введение интефейса в MCR алгоритм</p></li>
</ul>

<p>Натройка:</p>

<ul>
<li>В r_keeper менеджере и пройдите в <strong>Сервис -&gt; Интерфейсы</strong></li>
</ul>

<p><img src="../images/Pds_rk_manager.PNG" width="600"></p>

<ul>
<li>В открывшемся окне создайте новый PDS (или можно настроить имеющийся), и введите данные как показано ниже</li>
</ul>

<p><img src="../images/PDS_src.png" width="900"></p>

<ul>
<li><p>Далее, нужно создать кассовый сервер (устройство) и валюту PDS</p></li>
<li><p>Пройдите в <strong>Сервис -&gt; Стаанции и Устройства</strong>, откройте Cash Server вашего ресторана и создайте &quot;устройство&quot; с PDS интерфейсом.</p></li>
<li><p>В поле PDS Server Name введите название вашего интерфейса как показано ниже</p></li>
<li><p>Выберите &quot;Yes&quot; на <strong>Pass ALL Reciepts XML data</strong> и <strong>Pass ALL Bills XML data</strong></p></li>
</ul>

<p><img src="../images/rk_pds_server.png" width="900"></p>

<ul>
<li><p>Далее, для создания валюты пройдите в <strong>Деньги-&gt;Валюты</strong></p></li>
<li><p>В разделе оплаты картами создайте PDS оплату</p></li>
<li><p>В поле максимальный процент введите 100.00</p></li>
<li><p>В интерфейсе введите свой PDS интерфейс</p></li>
</ul>

<p><img src="../images/rk_currency.png" width="1000"></p>

<ul>
<li><p>Далее, введите данные о PDS интерфейсе в FARCARDS и TMS</p></li>
<li><p>Убедитесь что значение в поле <strong>Код</strong> записано в файлах TMS.ini и FARCARDS.ini:</p>

<ul>
<li>в файле TMS.ini пройдите в р аздел [CARDDATA] и поменяйте значение Interface на Interface = (введите значение <em>Кода</em>)</li>
<li>далее, в том же файле дайте то же значение для Interface в разделе [RTGI] как показано ниже</li>
</ul>

<p><img src="../images/TMS_ini.png" width="900">  </p></li>
<li><p>Убедитесь что название созданой PDS совпадает с названием указаным в FARCARDS.ini</p>

<ul>
<li>в файле FARCARDS.ini пройдите в раздел [pds_netk] и поменяйте значение NetServerName на NetServerName = (введите название PDS)</li>
</ul>

<p><img src="../images/FARCARDS_ini.png" width="900"></p>

<p>*имейте ввиду, что поочередность введения данных в файлах имеет значение. В TMS.ini сначала впишите Interface, а затем RKDeviceTypeKind.</p>

<p><em>При возникновении проблем при проведении транзакции, проверьте PDS_netk.log и удестоверьтесь что на FARCARDS запросы приходят справильного интерфейса. Запросы могут приходить с предустановленного интерфейса, в этом случае можно *</em>выключить предустановленный интерфейс***</p></li>
<li><p>Далее, зайдите в созданый вами MCR алгоритм и выберите созданый PDS в поле &quot;Обьект&quot;</p>

<p><img src="../images/MCR_pds.png" width="900"></p></li>
</ul>
<h2 id='fa903e6def-2'>Создание Бонуса или Подарочного сертификата</h2>
<ul>
<li><p>Зайдите в r_keeper менеджер</p></li>
<li><p>Пройдите в типы бонусов</p></li>
<li><p>Создайте новый бонус и назовите его <strong>LoonaBonus</strong></p></li>
<li><p>Пройдите в меню в раздел «Деньги» и откройте «Скидки и Наценки»</p></li>
</ul>

<p><img src="../images/rk5.png" width="900"></p>

<ul>
<li>  Откроется окно управления скидок и наценок, наведите мышь на поле «All» и с помощью правой кнопки мышки создайте новый тип скидок</li>
</ul>

<p><img src="../images/rk6.png" width="900" height="350"></p>

<ul>
<li>  Откроются «Свойства», в них введите Название своей скидки и поменяйте статус на Активный</li>
</ul>

<p><img src="../images/rk7.png" width="500"></p>

<ul>
<li>  Пройдите в окно «Скидки/Нацинки» и создайте новую скидку (Нажмите правой кнопки мышки на свободое поле, из возникших опций выберите «Новая скидка»)</li>
</ul>

<p><img src="../images/rk8.png" width="900"></p>

<ul>
<li>  Введите название вашей лояльности, пока что не меняйте статус на активный</li>
</ul>

<p><img src="../images/rk9.png" width="900"></p>

<ul>
<li>  Откройте детализацию вашей лояльности двойным кликом на иконку</li>
</ul>

<p><img src="../images/rk10.png" width="414" height="150"></p>

<ul>
<li>  Создайте новую детализацию (Нажмите правой кнопки мышки на свободое поле, из возникших опций выберите «Новая детализация»)</li>
</ul>

<p><img src="../images/rk11.png" width="345" height="347"></p>

<ul>
<li>  Откройте поле настроек детализации, и укажите &quot;тип бонуса&quot;: <strong>LoonaBonus</strong></li>
</ul>

<p><img src="../images/rk12.png" width="900"></p>

<ul>
<li>  Сохраните изменения </li>
</ul>

<p><img src="../images/rk13.png" width="900"></p>

<ul>
<li>  Пройдите обранто в «Свойства» вашей скидки и поменяйте статус на активный «Active»</li>
</ul>

<p><img src="../images/rk14.png" width="900"></p>

<ul>
<li>  Сохраните изменения, но еще не закрывайте окно «Скидки и Надбавки»</li>
</ul>
<h2 id='1bb1787d93-2'>Создание Скидки</h2>
<ul>
<li><p>Откройте систему r_keeper и зайдите в неё</p></li>
<li><p>Пройдите в меню в раздел «Деньги» и откройте «Скидки и Наценки»</p></li>
</ul>

<p><img src="../images/rk5.png" width="900"></p>

<ul>
<li>  Откроется окно управления скидок и наценок, наведите мышь на поле «All» и с помощью правой кнопки мышки создайте новый тип скидок</li>
</ul>

<p><img src="../images/rk6.png" width="900" height="350"></p>

<ul>
<li>  Откроются «Свойства», в них введите Название своей скидки и поменяйте статус на Активный</li>
</ul>

<p><img src="../images/rk7.png" width="500"></p>

<ul>
<li>  Пройдите в окно «Скидки/Нацинки» вашей новой скидки и создайте новую скидку (Нажмите правой кнопки мышки на свободое поле, из возникших опций выберите «Новая скидка»)</li>
</ul>

<p><img src="../images/rk8.png" width="900"></p>

<ul>
<li>  Введите название вашей скидки, пока что не меняйте статус на активный</li>
</ul>

<p><img src="../images/rk9.png" width="900"></p>

<ul>
<li>  Откройте детализацию вашей скидки двойным кликом на иконку</li>
</ul>

<p><img src="../images/rk10.png" width="414" height="150"></p>

<ul>
<li>  Создайте новую детализацию (Нажмите правой кнопки мышки на свободое поле, из возникших опций выберите «Новая детализация»)</li>
</ul>

<p><img src="../images/rk11.png" width="345" height="347"></p>

<ul>
<li>  Откройте поле настроек детализации, и поменяйте процент скидки на проценты скидок настроеные в кабинете</li>
</ul>

<p><img src="../images/rk_discount.png" width="900"></p>

<ul>
<li>  Сохраните изменения </li>
</ul>

<p><img src="../images/rk13.png" width="900"></p>

<ul>
<li>  Пройдите обранто в «Свойства» вашей скидки и поменяйте статус на активный «Active»</li>
</ul>

<p><img src="../images/rk14.png" width="900"></p>

<ul>
<li><p><strong>Повторите все пункты по созданию новой детализации для каждого уровня скидок имеющихся в вашем кабинете</strong></p></li>
<li><p>Сохраните изменения, но еще не закрывайте окно «Скидки и Надбавки»</p></li>
</ul>
<h2 id='a1b4ba21e5-2'>Создание Купона</h2>
<p>Для создания купона пройдите все пункты для создания скидки, но измените указаный процент скидки на 100%.</p>
<h2 id='35621b3930'>Необходимые Настройки в офисе и плагине</h2>
<ul>
<li><p>Откройте ваш браузер и пройдите по адресу: «localhost:1234/settings»</p></li>
<li><p>Откроется поле настроек плагина. </p></li>
<li><p>Задаем настройки:</p>

<ul>
<li>Api access token - доступен после создания сканера в кабинете (подробнее в разделе настройки кабинета) или по запросу от поддержки компании Loona</li>
<li>Api base url - https://api.loona.ai<br></li>
<li>Plugin url - http://localhost<br></li>
<li>Waiter port - 1234</li>
</ul></li>
<li><p>Далее, Введите необходимые параметры для настройки скидки и сохраните параметры. Код вашей скидки, бонуса или купона вам доступен в свойствах скидки в r_keeper manager.</p></li>
</ul>

<p><img src="../images/rk_plugin_levels.png" width="900"> </p>

<p><img src="../images/rk19.png" width="900"></p>

<ul>
<li><p>Сохраните изменения параметров плагина</p></li>
<li><p>Вернитесь в «Сервисы», выделите сервис Loona r-keeper plugin, обновите сервис (сервис должен выключится после обновления), затем запустите сервис</p></li>
</ul>

<p><img src="../images/rk20.png" width="900"></p>
<h2 id='4f6db5306b-2'>Настройки в кабинете</h2><h3 id='443ab601a2-2'>Редактирование макета:</h3>
<p><strong>Для использования скидок, бонусов и подарочных сертификатов</strong> в системе r_keeper штрихкод на карте должен содержать Номер Карты. Для настройки штрихкода на Номер Карты:</p>

<ul>
<li><p>Зайдите в ваш личный кабинет Loona</p></li>
<li><p>Перейдите в раздел <strong>Макеты</strong></p></li>
<li><p>Зайдите в <img src="../images/иконка%20редактирования.png" width="12" height="12" alt="редактирование"> <strong>редактирование</strong> того макета на который хотите настроить сканер</p></li>
</ul>

<p><img src="../images/r_keeper%20maket%20settings.png" width="650" height="375" alt="Card Design"></p>

<ul>
<li><p>Перейдите в секцию <strong>Дизайн</strong></p></li>
<li><p>Нажмите на штрихкод, в настройках поля откроются настройки штрихкода</p></li>
<li><p>Поменяйте тип штрихкода на QR</p></li>
<li><p>Поменяйте значение на <strong>Номер Карты</strong></p></li>
</ul>

<p><strong>Для использования купона:</strong></p>

<ul>
<li><p>В значении штрихкода поменять значение на “своё значение”</p></li>
<li><p>Поменять своё значение на ${pid}/№Продукт, где “№Продукт” это номер под которым позиция (блюдо) зарегистрирована в iikoOffice.</p></li>
<li><p>Использовать карты Loona</p></li>
</ul>
<h2 id='api-token-2'>Создание API Token сканера для карты</h2>
<p>Для иинтеграции с r_keeper вам необходимо создать сканер в кабинете Loona и использовать его токен доступа. </p>

<p>Для создания нового сканера:</p>

<ul>
<li>Зайдите в ваш личный кабинет Loona</li>
</ul>

<p><img src="../images/maket_create.png" width="600" alt="Maket Create"></p>

<ul>
<li><p>В разделе Сканер нажмите на Создать сканер.</p></li>
<li><p>Введите название нового сканера</p></li>
<li><p>Выберите тип сканера - &quot;App&quot;.</p></li>
<li><p>Выберите макеты с картами которые предназначены для сканирования, или отметьте Получить полный доступ чтобы сканер работал со всеми вашими макетами.</p></li>
<li><p>Нажмите Создать</p></li>
</ul>

<p>В списке созданных сканеров появится новый сканер со своим <strong>Идентификационным номером</strong>, этот номер используется при настройке плагина.</p>

      </div>
    </div>
  </body>
</html>
